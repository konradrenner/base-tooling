= base-tooling

Declarative + versioned base developer workstation setup for *macOS (Apple Silicon)* and *Linux*, compatible with +direnv+ + +devenv+ workflows.

== What this installs/configures

Global base tooling (declarative):

* Nix + flakes enabled
* Home Manager (Linux standalone)
* nix-darwin + Home Manager (macOS)
* direnv (+ nix-direnv)
* git
* some fun tools (Spotify, Gimp, VLC)
* VS Code + extensions:
** Dev Containers
** AsciiDoc
** PlantUML
** Eclipse keymap
** IntelliJ Code Formatter
* NetBeans
* devenv CLI
* graphviz, plantuml, fontconfig, curl
* GraalVM CE

Container engine: *Rancher Desktop* (recommended for Dev Containers)

* macOS: installed via nix-darwin Homebrew cask
* Linux: installed from upstream .deb release (at the moment only .deb is supported)

== Day-0: First installation (empty machine)

Run **one command**:

[source,bash]
----
curl -fsSL https://raw.githubusercontent.com/konradrenner/base-tooling/main/install.sh | bash -s -- --user ABC
----

This will:

. Install Nix using the Determinate Systems installer (if missing)
. Enable flakes
. Install Rancher Desktop on Linux (if missing)
. Clone this repo into ~/.base-tooling
. Apply configuration using:
.. macOS: +darwinConfigurations.default+
.. Linux: +homeConfigurations.konrad@linux+

After installation

. Restart terminal.
. Start Rancher Desktop once.
. In Rancher Desktop settings select container engine +dockerd (moby)+ for best VS Code Dev Containers compatibility. (if you are using Linux on arm64 rancher desktop is not supported, you have to manually install e.g. podman)
. Use +direnv+ + +devenv+ in your projects as usual.
. You can delete the created result folder

== Day-2: Updates / changes to the base setup

Go to the local checkout and run the update script (default path is a hidden directory in home):

[source,bash]
----
~/.base-tooling/update.sh --user ABC
----

This will:

* Pull the latest changes from the repository
* Rebuild and activate the system configuration

It does NOT update flake inputs automatically.

=== Updating Nix dependencies

Updating `flake.lock` must be done manually and is reserved for "central rollout and testing" (would be done from a platform team in a production environment):

[source,bash]
----
nix flake update
git commit -am "Update flake inputs"
git push
----

Therefore, just maintainers should update `flake.lock` locally, test it and then push it.

== Troubleshooting

=== macOS: git not found

If git isn’t available on a fresh macOS install, +install.sh+ triggers +xcode-select --install+.
After the install finishes, re-run the Day-0 command.

=== Linux: Rancher Desktop install

Linux installation uses upstream release packages (.deb/.rpm). If the distro doesn’t use +apt+/+rpm+, install Rancher Desktop manually and re-run +install.sh+.
